# Methods idea

## Analysis method

### Regression models

- Space state model with MCMC
    - 柔軟な表現力
    - ベイズで何が嬉しいのか:
        - パラメータを確率変数として考え，分布を推測するからパラメータの解釈がしやすい，伝統的な統計学ではパラメータは一点の定数と考えるから解釈が難しい．"パラメータがこの範囲にあるのはこの確率"と言える．
        - 不確実さを表現できる，つまり信用区間で"データが得られた時のパラメータの確率の幅"を表現できるから，このくらいの幅で変化するんだなって定量的に示せる．不確実性は事後分布として示されるから，EAP推定値とかだけでなく，変動幅も評価できる．
        - 一貫した流れで分析ができる，つまり，推論の流れがデータによって変わらないから信頼できる結果が得られやすい．
        - ASA声明
    - 欠損値をそのまま扱えて，欠損値を補完してくれる

- ベイズ構造時系列モデル
    - 状態空間モデルのうちの一つ．spike-and-slab priorを使った変数選択ができる(?)．
    - 説明しやすい(?)．
- ベイジアン変化点検出モデル
    - 心拍変動の変化点以前になにか特徴的な気象の変動があったと

- ARモデル系のパラメータをベイズ推定
    - AR系は外生変数を含まないから今回には合わない．

- ARIMAX, SARIMAX, RegARIMA系 + ベイズ推定
    - わからん
    - モデルの解釈が難しい．例えばARの部分はわかりやすい(ラグいくつまでの値が影響しているとか)けど，残差を取るところが難しいかな(?)

__どうして状態空間モデルを使うのか，or どうしてARモデル系を使うのか．そこをはっきりさせたい．__
- ARモデル系は定常過程に変換しなきゃいけないから，そのあとの解釈が容易でない?

__ベイズ統計を使うと何が嬉しいの?__
- モデルのパラメータが確率分布で表現できるから，影響するパラメータの値の範囲が見えて、解釈しやすい．
- 因果推論の枠組みにも対応できるから，爆弾低気圧っていう介入の影響とかを分析できそう．

### Feature engineering

- 正規化? or 標準化?
- Max
- Min
- Ave
- 前日との差 (前日に限らず)
- Max - Min
- ラグを取る
- 同じような変動をするやつでも使ってみる?
    - 範囲が違うからいいかな，
- __最大とかの時分はその時間の生体情報の計測が存在しないことがほとんどだから使わなくていいかな__

### Tips

- モデル選択は何を基準に進めるの? WAICとかいろいろあるよね

- モデルが確定したあとに，モデルの妥当性を確認するために生データと予測の残差をとってホワイトノイズに近づいているか確認する．

- 変数減少法とか

- 多重共線性

- CVの切り方，最後の数ヶ月を検証用データとして切っておくとか，Leave-one-out

- どうモデルを理解すればいいの?係数の比較によってかな

- ベイズ統計で分析する時に報告すべき情報たち [Bayesian analysis guildelines](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8526359/)
    - 事前分布は何を設定したの?
    - 信頼区間は何を設定したの?
    - 感度分析 (?)
    - MCMCの収束はどう判断したの?
    - どんなモデルを使ったの?
    - どうやってモデル選択したの?

### Visualization

- 似た天気の日は似たHRVの値になるのかクラスタリングしてみたり．

- いつもよりHRVの値が違う日に注目して，その日の24時間分の天気を見てなんか特徴的な天気がないか見てみる．

- インパルス応答とか見てみたり．

## HRV parameters

Time domain
- Heart rate (beats/min)
- SDNN, RMSSD (msec)
- pnn50 (%)
- TINN (msec) (?)

Frequency domain
- VLF, LF, HF ($msec^2$)
- LF/HF (%)


_Non-linear_ domain (option  time/frequency domain params are not related)
- _CD_ (-)
- _ApEn_ (-)
- _SD1, SD2_ (msec)
- _SD1/SD2_ (%)

[HRV parameters calculation](https://github.com/MarcusVollmer/HRV)

相関があるやつはどっちか消してもいいかな
-> 相関のヒートマップから判断してもいいかな，自律神経系の指標となりうるものを優先して残しながら選択していけばいいと思う
-> ~~SD1はRMSSD，SD2はLF，SD1/SD2はLF/HFと相関があるからいらない？？？~~ オプションとして残しておくけど，使わない可能性大

## Meteorological factors

### Features (daily)

- 湿度系
    - 日平均蒸気圧 (hPa)
    - 日平均相対湿度 (%)
    - 日最小相対湿度 (%)
    - ~~日最小値の発生時刻 (option)~~

- 気圧系
    - 日平均現地気圧 (hPa)
    - 日平均海面気圧 (hPa)
    - 日最低海面気圧 (hPa)
    - ~~日最低海面気圧発生時刻 (option)~~

- 雨系
    - 日合計降水量 (mm)
    - 日最大1時間降水量 (mm)
    - ~~日最大1時間降水の発生時刻 (option)~~

- 日光系
    - 日合計日照時間 (hour)

- 気温系
    - 日平均気温 (℃)
    - 日最高気温 (℃)
    - ~~日最高気温発生時刻 (option)~~
    - 日最低気温 (℃)
    - ~~日最低気温発生時刻 (option)~~

- 風系
    - 日平均風速 (m/s)
    - 日最大風速 (m/s)
    - ~~日最大風速発生時刻 (option)~~
    - ~~日最大風速風向 (東西南北)~~
    - 日瞬間最大風速 (m/s)
    - ~~日瞬間最大風速発生時刻 (option)~~
    - ~~日瞬間最大風速風向 (東西南北)~~
    - 日最多風向 (東西南北)

---

Possible
- _Lunar cycle_
- _Weathr front_
- _Thunder_
- _Fog_
- _真夏日，猛暑日，ゲリラ豪雨，台風，爆弾低気圧(要定義確認)，熱帯夜みたいな気象イベント_
- _連続した雨とか曇りの日_
- _平均だけとかじゃなくて，ある特定の時間のデータを使う_
- _四季_
- _曜日_

## Figure
- 使った特徴量を気象要因とHRVでそれぞれ表をつくる
